<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>DialogRunner and a High Level Overview - Yarn Slinger Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../working_with_yarn_slinger.html"><strong aria-hidden="true">2.</strong> Working with Yarn Slinger</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yarn_files.html"><strong aria-hidden="true">2.1.</strong> Yarn Files</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yarn_files/basics.html"><strong aria-hidden="true">2.1.1.</strong> Basics</a></li><li class="chapter-item expanded "><a href="../yarn_files/running_examples.html"><strong aria-hidden="true">2.1.2.</strong> Running Examples</a></li><li class="chapter-item expanded "><a href="../yarn_files/lines.html"><strong aria-hidden="true">2.1.3.</strong> Lines</a></li><li class="chapter-item expanded "><a href="../yarn_files/variables.html"><strong aria-hidden="true">2.1.4.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../yarn_files/options.html"><strong aria-hidden="true">2.1.5.</strong> Options</a></li><li class="chapter-item expanded "><a href="../yarn_files/nodes.html"><strong aria-hidden="true">2.1.6.</strong> Nodes</a></li><li class="chapter-item expanded "><a href="../yarn_files/markup.html"><strong aria-hidden="true">2.1.7.</strong> Markup</a></li><li class="chapter-item expanded "><a href="../yarn_files/functions.html"><strong aria-hidden="true">2.1.8.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../yarn_files/commands.html"><strong aria-hidden="true">2.1.9.</strong> Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../bevy_plugin.html"><strong aria-hidden="true">2.2.</strong> Bevy Plugin</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../bevy_plugin/setup.html"><strong aria-hidden="true">2.2.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/compiling_yarn_files.html"><strong aria-hidden="true">2.2.2.</strong> Compiling Yarn Files</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/dialog_runner.html" class="active"><strong aria-hidden="true">2.2.3.</strong> DialogRunner and a High Level Overview</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/localization.html"><strong aria-hidden="true">2.2.4.</strong> Localization</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/assets.html"><strong aria-hidden="true">2.2.5.</strong> Assets</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/variable_storage.html"><strong aria-hidden="true">2.2.6.</strong> Variable Storage</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/custom_functions.html"><strong aria-hidden="true">2.2.7.</strong> Custom Functions</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/custom_commands.html"><strong aria-hidden="true">2.2.8.</strong> Custom Commands</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/dialog_views.html"><strong aria-hidden="true">2.2.9.</strong> Dialog Views</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../porting_yarn_slinger.html"><strong aria-hidden="true">3.</strong> Porting Yarn Slinger</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yarn Slinger Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/yarn-slinger/yarn-slinger" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/yarn-slinger/yarn-slinger/edit/main/docs/src/bevy_plugin/dialog_runner.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dialogrunner-and-a-high-level-overview"><a class="header" href="#dialogrunner-and-a-high-level-overview"><code>DialogRunner</code> and a High Level Overview</a></h1>
<p>The main way to actually manipulate the state of your dialog is through a <code>DialogRunner</code>.
You create it from a <code>YarnProject</code> (see <a href="compiling_yarn_files.html">Compiling Yarn Files</a>) with either
<code>YarnProject::create_dialog_runner()</code> or <code>YarnProject::build_dialog_runner()</code>. 
The first uses default configurations which should be alright for many use-cases, 
while the latter allows you to add or change functionality.</p>
<h2 id="dialog-flow"><a class="header" href="#dialog-flow">Dialog Flow</a></h2>
<p>The actual navigation through a dialog is handled by a <a href="dialog_views.html">dialog view</a>, 
which is responsible for back-and-forth interaction with the player.
As such, most of the methods provided by a <code>DialogRunner</code> are to be called by such a view.
The one you will want to call yourself, as seen in the <a href="setup.html">setup</a>, is <code>DialogRunner::start_node</code>,
which will tell the <code>DialogRunner</code> to start running from the provided <a href="../yarn_files/nodes.html">node</a>.</p>
<h2 id="variable-storage"><a class="header" href="#variable-storage">Variable Storage</a></h2>
<p><a href="../yarn_files/variables.html">Variables</a> need to be stored in some place. By default, they are kept in memory through the <code>InMemoryVariableStorage</code>.
This means that when you quit and reopen the game, all variables used in Yarn files will be empty again. Of course, this is suboptimal when you want to allow
the player saving and loading their game state. To accomplish this, you can go one of two routes:</p>
<ul>
<li>Manipulate the variables in the variable store. Read then when saving and write them when loading.
You can access the variable storage through <code>DialogRunner::variable_storage()</code>.</li>
<li>Directory use a variable storage that stores its variables in a persistent way, such as a database or a file.
You can change the underlying variable storage through the builder API discussed later in this chapter.</li>
</ul>
<p>For information on how to create your own variable storage, see the chapter <a href="./variable_storage">Variable Storage</a></p>
<h2 id="functions-and-commands"><a class="header" href="#functions-and-commands">Functions and Commands</a></h2>
<p>Yarn files can contain user-defined functions and commands. These can be accessed with
<code>DialogRunner::library()</code> and <code>DialogRunner::commands()</code>. For more information, see the chapters <a href="custom_functions.html">Custom Functions</a> 
and <a href="custom_commands.html">Custom Commands</a>.</p>
<h2 id="text-and-assets"><a class="header" href="#text-and-assets">Text and Assets</a></h2>
<p>We make a distinction between <em>text</em>, which are the written words organized into <em>lines</em> contained in Yarn files or in 
<a href="localization.html">localization files</a>, and <em>assets</em>, which are supplemental data associated with a line. 
Assets are referenced over a Bevy <code>Handle</code> and can be used for things such as voiceover sound files or images that might need translation.</p>
<p>Of note is that using assets <strong>requires</strong> using <a href="localization.html">localization</a>, or at least thinking about it.
As a consequence, language settings are split between text and assets. After all, a player might want to hear lines delivered in the original recorded language but read the text translated into their own language.</p>
<p>You can read more about how current language can be set for a <code>DialogRunner</code> in the <a href="localization.html">localization</a> chapter.</p>
<p>Text is provided by a <code>TextProvider</code>. While it can be overwritten, the default <code>StringsFileTextProvider</code> will be a good choice for
nearly all users. The only reason you might have to create an own <code>TextProvider</code> is if you want a very custom localization strategy, such as
translating text automatically through AI.</p>
<p>Assets are provided by <code>AssetProvider</code>s. In contrast to the <code>TextProvider</code>, you might very well create your own <code>AssetProvider</code>. 
For your convenience, Yarn Slinger already ships with an <code>AudioAssetProvider</code> that you can use for voice lines and a <code>FileExtensionAssetProvider</code> 
that can load any asset based on naming conventions and file extensions. See the chapter <a href="assets.html">Assets</a>.</p>
<p>Text and asset providers can be set through the builder API and accessed later with <code>DialogRunner::text_provider()</code> and <code>DialogRunner::asset_providers()</code>. If you know the exact type <code>T</code> of <code>AssetProvider</code> you
want, you can call <code>DialogRunner::asset_provider::&lt;T&gt;()</code> instead.</p>
<h2 id="builder-api"><a class="header" href="#builder-api">Builder API</a></h2>
<p>As mentioned in the beginning of this chapter, a <code>DialogRunner</code> can be modified or extended on creation
by using <code>YarnProject::build_dialog_runner()</code>. In fact, <code>YarnProject::create_dialog_runner()</code> is nothing but a shorthand for <code>YarnProject::build_dialog_runner().build()</code>.</p>
<p>You can use the builder API to inject your own implementations of traits used for the features presented in this chapter.
<code>DialogueRunnerBuilder::with_variable_storage</code> changes the underlying <code>VariableStorage</code> and <code>DialogueRunnerBuilder::with_text_provider</code> the <code>TextProvider</code>.
<code>DialogueRunnerBuilder::add_asset_provider</code> adds an <code>AssetProvider</code> to the set of asset providers called for each line presented to the player.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../bevy_plugin/compiling_yarn_files.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../bevy_plugin/localization.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../bevy_plugin/compiling_yarn_files.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../bevy_plugin/localization.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
