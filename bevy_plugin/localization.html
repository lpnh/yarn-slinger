<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Localization - Yarn Slinger Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../working_with_yarn_slinger.html"><strong aria-hidden="true">2.</strong> Working with Yarn Slinger</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yarn_files.html"><strong aria-hidden="true">2.1.</strong> Yarn Files</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../yarn_files/basics.html"><strong aria-hidden="true">2.1.1.</strong> Basics</a></li><li class="chapter-item expanded "><a href="../yarn_files/running_examples.html"><strong aria-hidden="true">2.1.2.</strong> Running Examples</a></li><li class="chapter-item expanded "><a href="../yarn_files/lines.html"><strong aria-hidden="true">2.1.3.</strong> Lines</a></li><li class="chapter-item expanded "><a href="../yarn_files/variables.html"><strong aria-hidden="true">2.1.4.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../yarn_files/options.html"><strong aria-hidden="true">2.1.5.</strong> Options</a></li><li class="chapter-item expanded "><a href="../yarn_files/nodes.html"><strong aria-hidden="true">2.1.6.</strong> Nodes</a></li><li class="chapter-item expanded "><a href="../yarn_files/markup.html"><strong aria-hidden="true">2.1.7.</strong> Markup</a></li><li class="chapter-item expanded "><a href="../yarn_files/functions.html"><strong aria-hidden="true">2.1.8.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../yarn_files/commands.html"><strong aria-hidden="true">2.1.9.</strong> Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../bevy_plugin.html"><strong aria-hidden="true">2.2.</strong> Bevy Plugin</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../bevy_plugin/setup.html"><strong aria-hidden="true">2.2.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/compiling_yarn_files.html"><strong aria-hidden="true">2.2.2.</strong> Compiling Yarn Files</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/dialog_runner.html"><strong aria-hidden="true">2.2.3.</strong> DialogRunner and a High Level Overview</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/localization.html" class="active"><strong aria-hidden="true">2.2.4.</strong> Localization</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/assets.html"><strong aria-hidden="true">2.2.5.</strong> Assets</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/variable_storage.html"><strong aria-hidden="true">2.2.6.</strong> Variable Storage</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/custom_functions.html"><strong aria-hidden="true">2.2.7.</strong> Custom Functions</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/custom_commands.html"><strong aria-hidden="true">2.2.8.</strong> Custom Commands</a></li><li class="chapter-item expanded "><a href="../bevy_plugin/dialog_views.html"><strong aria-hidden="true">2.2.9.</strong> Dialog Views</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../porting_yarn_slinger.html"><strong aria-hidden="true">3.</strong> Porting Yarn Slinger</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Yarn Slinger Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/yarn-slinger/yarn-slinger" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/yarn-slinger/yarn-slinger/edit/main/docs/src/bevy_plugin/localization.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="localization"><a class="header" href="#localization">Localization</a></h1>
<p>If you only want to support a single language, you can safely ignore localization features.
As soon as you want to support <a href="assets.html">assets</a> or multiple languages however, you will need to use localization.
Fortunately Yarn Slinger makes this quite easy!</p>
<p>Let's first look at how to use localization and then explain what's going on under the hood.</p>
<h2 id="using-localization-the-easy-way"><a class="header" href="#using-localization-the-easy-way">Using Localization the Easy Way</a></h2>
<p>We specify our supported localizations when creating the <a href="compiling_yarn_files.html"><code>YarnSlingerPlugin</code> (or using deferred compilation)</a>:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>YarnSlingerPlugin::new().with_localizations(Localizations {
    base_localization: &quot;en-US&quot;.into(),
    translations: vec![&quot;de-CH&quot;.into()],
})
<span class="boring">}</span></code></pre></pre>
<p>The <em>base localization</em> is the language in which your Yarn files are already written. 
In this case, we specified that our Yarn file was written in English as spoken in the USA.
The <em>translations</em> are all languages you want to support. Here, we want to support German as spoken in Switzerland.</p>
<p>Put the code shown above into the example used in the <a href="setup.html">setup</a> and run the game. </p>
<p>Now take a look at your Yarn file at <code>assets/dialog/example.yarn</code>. 
You will see that your line of dialog will contain an autogenerated ID, for example:</p>
<pre><code class="language-diff"># assets/dialog/example.yarn
title: Start
---
- Hello World!
+ Hello World! #line:13032079 
===
</code></pre>
<p>This ID uniquely references this line across translations.
For the sake of clarity, we will use diff highlighting throughout this chapter.
In case you're not familiar with this look, for our purposes the red line started by &quot;- &quot; shows how the line looked like before a change,
while the green line started by &quot;+ &quot; shows how the line looks like after the change. The &quot;- &quot; and &quot;+ &quot; are just visual indicators and not actually part
of the files, so don't let that confuse you!</p>
<p>You will probably also have noticed a new file in your assets that was not there before, namely &quot;de-CH.strings.csv&quot;:</p>
<p><img src="strings_file_generated.png" alt="strings_file_generated.png" /></p>
<p>This file is called a <em>strings file</em>, because it contains translations of each <em>string</em> of text of your Yarn files.
Let's see what it contains:</p>
<pre><code class="language-csv">language,id,text,file,node,line_number,lock,comment
de-CH,line:13032079,Hello World!,example.yarn,Start,4,7f83b165,
</code></pre>
<p>Since this is a CSV, let's open it in an application that renders the content as a table:
<img src="strings_file_new.png" alt="strings_file_new.png" /></p>
<p>You can see that our line from before is in there! Notice how the <code>id</code> matches across the files.</p>
<p>This file will be populated with new entries as soon you change the Yarn files. Assuming that you
are using hot reloading as described in the <a href="setup.html">setup</a>, run your app again in case you closed it or advanced the dialog.
While you are greeted with the &quot;Hello World!&quot; message on screen, open the Yarn file and edit it. Let's add a new line:</p>
<pre><code class="language-diff"># assets/dialog/example.yarn
title: Start
---
Hello World! #line:13032079 
+ This is a brand new line of text
===
</code></pre>
<p>Save the file while the game is still running. You should see that our new line just got assigned an own line ID:</p>
<pre><code class="language-diff"># assets/dialogue/example.yarn
title: Start
---
Hello World! #line:13032079
- This is a brand new line of text
+ This is a brand new line of text #line:10414042 
===
</code></pre>
<p>In case you can't see this, your editor might still have the old state of the file cached. It usually helps to change focus, tab out to another window, or closing and reopening the editor.
The strings file should now also contain a new entry:</p>
<p><img src="strings_file_another_line.png" alt="strings_file_another_line.png" /></p>
<p>Let's translate some of this. Change the string &quot;Hello World!&quot; in this file to &quot;Hallo Welt!&quot;, which is German, and save it:</p>
<p><img src="strings_file_translated.png" alt="strings_file_translated.png" /></p>
<p>The game will currently happily ignore this as by default it uses the base language, which means it will take
its text straight from the Yarn files. But we can easily switch the language:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn spawn_dialogue_runner(mut commands: Commands, project: Res&lt;YarnProject&gt;) {
    let mut dialogue_runner = project.create_dialogue_runner();
    dialogue_runner.start_node(&quot;Start&quot;);
    dialogue_runner.set_language(&quot;de-CH&quot;); // Use our translation
    commands.spawn(dialogue_runner);
}
<span class="boring">}</span></code></pre></pre>
<p>Run the game again and you should be greeted by this text: 
<img src="translated_line.png" alt="translated_line.png" /></p>
<p>Hurray! See how painless localization can be?</p>
<h2 id="languages"><a class="header" href="#languages">Languages</a></h2>
<p>Languages are specified according to IETF BCP 47.
You can add as many translations as you want. Each will receive an own strings file. </p>
<p>To switch languages at runtime, simply retrieve a <code>DialogRunner</code> through a Bevy query inside a system.
When you use <code>DialogRunner::set_language()</code> as shown above, you will set the language for both text and assets.
You can be more granular by using <code>DialogRunner::set_text_language()</code> and <code>DialogRunner::set_asset_language()</code> separately instead.
This allows you to support use cases such as showing the text in the player's native language and play voiceover sound in the original recorded language, which might be a different one.</p>
<h2 id="assets"><a class="header" href="#assets">Assets</a></h2>
<p>Since assets require using localization, they are searched for in folders named after the language they support. 
For the example used throughout this chapter, the assets for the base localization would be searched for in <code>assets/dialog/en-US/</code>, while the assets for the <code>de-CH</code> 
translation will be searched at <code>assets/dialog/de-CH/</code>. This is however more a convention than a rule, as a given <code>AssetProvider</code> is allowed to look for its assets wherever.
The asset providers shipped by Yarn Slinger will additionally expect assets to be named after the line ID they belong to. For example, the <code>AudioAssetProvider</code> would look for the
voice line reading our &quot;Hello World!&quot; line at <code>assets/dialog/en-US/13032079.mp3</code> for the base localization.</p>
<p>To read more about how to use assets, read the chapter <a href="./assets.html">Assets</a>.</p>
<h2 id="file-editing-workflow"><a class="header" href="#file-editing-workflow">File Editing Workflow</a></h2>
<p>The strings file can be freely edited by a translator in the <em>text</em> and <em>comment</em> fields. 
While you can translate the texts yourself, the format being straightforward allows the translator to also be someone else that is not involved with the coding part of the game at all.</p>
<p>You might have some questions regarding what happens when one person edits a Yarn file while another edits the strings file. As a general rule,
the strings file will try to &quot;keep up&quot; with the Yarn file without ever destroying anything that was already translated.</p>
<p>As you've seen, new lines will be amended. If the Yarn file has a line edited, it will be changed in the strings file as well if it was not yet translated. 
If there is already a translation, it will be marked by a &quot;NEEDS UPDATE&quot; prefix in the text. If a line was deleted in the Yarn file, it will also be deleted
in the strings file if it was untranslated. Otherwise, it will be left untouched. </p>
<p>Bottom line: if there's a translation, it will <strong>never</strong> be removed.</p>
<h2 id="shipping-the-game"><a class="header" href="#shipping-the-game">Shipping the Game</a></h2>
<p>Once you want to build your game for a release, you should disable the automatic file creation and editing.
To do this, add the following line to the plugin creation:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>YarnSlingerPlugin::new()
// ...
.with_development_file_generation(DevelopmentFileGeneration::None)
<span class="boring">}</span></code></pre></pre>
<p>This will change the behavior of missing translations to simply fall back to the base localization.</p>
<p>While you're on it, you might also want to disable Bevy's hot reloading.</p>
<h2 id="customization"><a class="header" href="#customization">Customization</a></h2>
<p>You may have wondered what the <code>.into()</code>s were for in the lines at the beginning of the chapter:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>YarnSlingerPlugin::new().with_localizations(Localizations {
    base_localization: &quot;en-US&quot;.into(),
    translations: vec![&quot;de-CH&quot;.into()],
})
<span class="boring">}</span></code></pre></pre>
<p>They're here because a localization is not just a string with a language code, but an entire struct, namely <code>Localization</code>.
You can construct this struct directly the path to the strings file and where assets are searched for.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../bevy_plugin/dialog_runner.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../bevy_plugin/assets.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../bevy_plugin/dialog_runner.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../bevy_plugin/assets.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
